/*
 * This script explains how to perform Swap intent when the okto auth token is available
 */

import { toHex, type Hash, type Hex } from "viem";
import { v4 as uuidv4 } from "uuid";
import { Constants } from "../helper/constants.js";
import { paymasterData } from "../utils/generatePaymasterData.js";
import {
  signUserOp,
  executeUserOp,
  type SessionConfig,
} from "../utils/invokeExecuteUserOp.js";
import { swapEstimateUserOp } from "../utils/invokeEstimateUserOp.js";
import { getChains } from "../explorer/getChains.js";
import { getAccount } from "../explorer/getAccount.js";
import { getOrderHistory } from "../utils/getOrderHistory.js";

import dotenv from "dotenv";

dotenv.config();
const OktoAuthToken = process.env.OKTO_AUTH_TOKEN as string;

interface Data {
  fromChainCaip2Id: string;
  fromChainTokenAmount: string;
  toChainCaip2Id: string;
  fromChainTokenAddress: string;
  toChainTokenAddress: string;
  slippage: string;
  sameChainFee: string;
  sameChainFeeCollector: string;
  crossChainFee: string;
  crossChainFeeCollector: string;
  toTokenAmountMinimum: any;
  advancedSettings: any;
}

/**
 * Creates, estimates and executes a user operation for Swap.
 *
 * This function initiates the process of performing a swap by encoding the necessary parameters into a User Operation.
 * For more information, check https://docs.okto.tech/docs/openapi/swapIntent            TODO: update link when docs is done
 *
 * @param data - The parameters for transferring the token (caip2Id, recipientWalletAddress, tokenAddress, amount)
 * @param sessionConfig - The sessionConfig object containing user SWA and session keys.
 * @returns The job ID for the token transfer.
 */
export async function swap(data: Data, sessionConfig: SessionConfig) {
  // Generate a unique UUID based nonce
  const nonce = uuidv4();
  console.log("NONCE:");

  const wallets = await getAccount(OktoAuthToken);
  console.log("Wallets: ", JSON.stringify(wallets, null, 2));

  // get the Chain CAIP2ID required for payload construction
  // Note: Only the chains enabled on the Client's Developer Dashboard will be shown in the response
  const chains = await getChains(OktoAuthToken);
  console.log("Chains: ", chains);
  // Sample Response:
  //   Chains:  [
  //   {
  //     caip_id: 'eip155:8453',
  //     network_name: 'BASE',
  //     chain_id: '8453',
  //     logo: 'BASE',
  //     sponsorship_enabled: false,
  //     gsn_enabled: false,
  //     type: 'EVM',
  //     network_id: '9400de12-efc6-3e69-ab02-0eaf5aaf21e5',
  //     onramp_enabled: false,
  //     whitelisted: true
  //   },
  //   {
  //     caip_id: 'solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1',
  //     network_name: 'SOLANA_DEVNET',
  //     chain_id: '103',
  //     logo: 'SOL DEVNET',
  //     sponsorship_enabled: false,
  //     gsn_enabled: false,
  //     type: 'SVM',
  //     network_id: 'fb10a9ca-d197-378d-8fb3-fd95345571f3',
  //     onramp_enabled: false,
  //     whitelisted: true
  //   },
  //   {
  //     caip_id: 'eip155:84532',
  //     network_name: 'BASE_TESTNET',
  //     chain_id: '84532',
  //     logo: 'BASE_TESTNET',
  //     sponsorship_enabled: false,
  //     gsn_enabled: false,
  //     type: 'EVM',
  //     network_id: '8970cafe-4fc2-3a71-a7d3-77a672b749e9',
  //     onramp_enabled: false,
  //     whitelisted: true
  //   }
  // ]

  const fromChain = chains.find(
    (chain: any) => chain.caip_id === data.fromChainCaip2Id
  );
  if (!fromChain) {
    throw new Error(`From Chain Not Supported`);
  }

  const toChain = chains.find(
    (chain: any) => chain.caip_id === data.toChainCaip2Id
  );
  if (!toChain) {
    throw new Error(`Destination Chain Not Supported`);
  }

  // create the Estimate UserOp payload for token transfer intent
  console.log("generating estimateUserOp Payload..."); // to be removed
  const estimateUserOpPayload = {
    type: "SWAP",
    jobId: nonce,
    paymasterData: await paymasterData({
      nonce,
      validUntil: new Date(Date.now() + 6 * Constants.HOURS_IN_MS),
    }),
    gasDetails: {
      maxFeePerGas: "", // 0xBA43B7400
      maxPriorityFeePerGas: "", // 0xBA43B7400
    },
    details: {
      fromChainTokenAddress: data.fromChainTokenAddress,
      fromChainCaip2Id: data.fromChainCaip2Id,
      toChainTokenAddress: data.toChainTokenAddress,
      toChainCaip2Id: data.toChainCaip2Id,
      sameChainFee: data.sameChainFee,
      sameChainFeeCollector: data.sameChainFeeCollector,
      crossChainFee: data.crossChainFee,
      crossChainFeeCollector: data.crossChainFeeCollector,
      fromChainTokenAmount: data.fromChainTokenAmount,
      minToTokenAmount: data.toTokenAmountMinimum,
      slippage: data.slippage,
      advancedSettings: data.advancedSettings,
    },
  };

  console.log("estimate userop payload", estimateUserOpPayload);
  // Sample Payload: {
  //     "type": "SWAP",
  //     "jobId": "32d3631b-04fc-4d9b-b803-88a5634c4c3f",
  //     "paymasterData": "0x000000000000000000000000055f44a1f92651557fd7f8e47ced5fdd2fb5e02b00000000000000000000000000000000000000000000000000000000681923ec0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000415b13a7a5a7a0274d3caecf1f108c7f409409c0f61751ae969625d187566cf6b725cf2b4e02be9cb6eb7e0e3d3c2db6feb5e8a125b4312862ac5e6c36892ec7721b00000000000000000000000000000000000000000000000000000000000000",
  //     "gasDetails": {
  //         "maxFeePerGas": "0x1ad274800",
  //         "maxPriorityFeePerGas": "0x1ad274800"
  //     },
  //     "details": {
  //         "fromChainTokenAddress": "",
  //         "fromChainCaip2Id": "eip155:137",
  //         "toChainTokenAddress": "0x88c949b4eb85a90071f2c0bef861bddee1a7479d",
  //         "toChainCaip2Id": "eip155:137",
  //         "sameChainFee": "10",
  //         "sameChainFeeCollector": "0x2c2505D0E21f32F38bCEBeca1C331ab4069bBCb9",
  //         "crossChainFee": "10",
  //         "crossChainFeeCollector": "0x2c2505D0E21f32F38bCEBeca1C331ab4069bBCb9",
  //         "fromChainTokenAmount": "10000",
  //         "minToTokenAmount": "0",
  //         "slippage": "2",
  //         "advancedSettings": {}
  //     }
  // }

  console.log("calling estimate userop...");

  try {
    const estimateUserOpResponse = await swapEstimateUserOp(
      estimateUserOpPayload,
      OktoAuthToken
    );
    console.log("estimateUserOpResponse:", estimateUserOpResponse);

    // Sample Response:
    //   estimateUserOpResponse: {
    //     "status": "success",
    //     "data": {
    //         "callData": {
    //             "clientSWA": "0x055F44a1f92651557FD7f8E47ceD5fDd2fb5e02B",
    //             "feePayerAddress": "",
    //             "gsn": {
    //                 "isPossible": false,
    //                 "isRequired": false,
    //                 "requiredNetworks": [],
    //                 "tokens": []
    //             },
    //             "intentType": "SWAP",
    //             "jobId": "32d3631b-04fc-4d9b-b803-88a5634c4c3f",
    //             "payload": {
    //                 "advancedSettings": {
    //                     "slippageUsed": "4"
    //                 },
    //                 "crossChainFee": "10",
    //                 "crossChainFeeCollector": "0x2c2505D0E21f32F38bCEBeca1C331ab4069bBCb9",
    //                 "fromChainCaip2Id": "eip155:137",
    //                 "fromChainTokenAddress": "",
    //                 "fromChainTokenAmount": "10000",
    //                 "minToTokenAmount": "16716408",
    //                 "routeId": "e2dea6cf-22da-52f1-a293-a41244cca755",
    //                 "sameChainFee": "10",
    //                 "sameChainFeeCollector": "0x2c2505D0E21f32F38bCEBeca1C331ab4069bBCb9",
    //                 "slippage": "2",
    //                 "toChainCaip2Id": "eip155:137",
    //                 "toChainTokenAddress": "0x88c949b4eb85a90071f2c0bef861bddee1a7479d"
    //             },
    //             "policies": {
    //                 "gsnEnabled": false,
    //                 "sponsorshipEnabled": false
    //             },
    //             "userSWA": "0x0dca2A8535a81B8dbC22ca7B3e2973fE38320Cf6"
    //         },
    //         "details": {
    //             "estimation": {
    //                 "amount": "",
    //                 "crossChainFee": "",
    //                 "crossChainFeeCollector": "",
    //                 "gasFeesInInputToken": "",
    //                 "integratorFeesInInputToken": "",
    //                 "outputAmount": "16716408",
    //                 "platformBaseFeesInInputToken": "",
    //                 "recommendedSlippage": "4",
    //                 "routeId": "20de41f6-80e5-4bf4-bb4a-72b5d7f68346",
    //                 "routeValidUntil": "",
    //                 "sameChainFee": "",
    //                 "sameChainFeeCollector": "",
    //                 "slippageUsed": "4",
    //                 "totalFeesInInputToken": ""
    //             },
    //             "fees": {
    //                 "approxTransactionFeesInUSDT": "",
    //                 "transactionFees": {
    //                     "eip155:137": "10741272513527958"
    //                 }
    //             },
    //             "swapFees": {
    //                 "gasFeesInInputToken": "",
    //                 "integratorFeesInInputToken": "",
    //                 "platformBaseFeesInInputToken": "",
    //                 "totalFeesInInputToken": ""
    //             }
    //         },
    //         "userOps": {
    //             "callData": "0x8dd7712f00000000000000000000000000000000000000000000000000000000000000000000000000000000b5e77f7ff1ab31fc1be99f484db62f01a6b93d4d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000007c4bf7b90d70000000000000000000000000000000032d3631b04fc4d9bb80388a5634c4c3f000000000000000000000000055f44a1f92651557fd7f8e47ced5fdd2fb5e02b0000000000000000000000000dca2a8535a81b8dbc22ca7b3e2973fe38320cf60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000240000000000000000000000000000000000000000000000000000000000000078000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000520000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000027100000000000000000000000000000000000000000000000000000000000000240000000000000000000000000000000000000000000000000000000000000028000000000000000000000000000000000000000000000000000000000000002c000000000000000000000000000000000000000000000000000000000000002e00000000000000000000000000000000000000000000000000000000000000340000000000000000000000000000000000000000000000000000000000000038000000000000000000000000000000000000000000000000000000000000003c00000000000000000000000000000000000000000000000000000000000000420000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004c0000000000000000000000000000000000000000000000000000000000000002465326465613663662d323264612d353266312d613239332d61343132343463636137353500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a6569703135353a31333700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a6569703135353a31333700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000831363731363430380000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a307838386339343962346562383561393030373166326330626566383631626464656531613734373964000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001320000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000023130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a3078326332353035443045323166333246333862434542656361314333333161623430363962424362390000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000023130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a3078326332353035443045323166333246333862434542656361314333333161623430363962424362390000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000147b22736c69707061676555736564223a2234227d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000004535741500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
    //             "callGasLimit": "0x547fc",
    //             "maxFeePerGas": "0x1ad274800",
    //             "maxPriorityFeePerGas": "0x1ad274800",
    //             "nonce": "0x0000000000000000000000000000000032d3631b04fc4d9bb80388a5634c4c3f",
    //             "paymaster": "0xdaa292e9b9a6b287c84d636f3b65f4a5dc787e3f",
    //             "paymasterData": "0x000000000000000000000000055f44a1f92651557fd7f8e47ced5fdd2fb5e02b00000000000000000000000000000000000000000000000000000000681923ec0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000415b13a7a5a7a0274d3caecf1f108c7f409409c0f61751ae969625d187566cf6b725cf2b4e02be9cb6eb7e0e3d3c2db6feb5e8a125b4312862ac5e6c36892ec7721b00000000000000000000000000000000000000000000000000000000000000",
    //             "paymasterPostOpGasLimit": "0x2857",
    //             "paymasterVerificationGasLimit": "0x138bb",
    //             "preVerificationGas": "0x16d3c",
    //             "sender": "0x0dca2a8535a81b8dbc22ca7b3e2973fe38320cf6",
    //             "verificationGasLimit": "0x286f9"
    //         }
    //     }
    // }

    // Get the UserOp from the estimate response fetched above, sign it and add the signature to the userOp
    const userOp = estimateUserOpResponse.data?.userOps;
    console.log("UserOp: ", userOp);
    // Sample Response:
    // Unsigned UserOp: {
    //   "callData": "0x8dd7712f00000000000000000000000000000000000000000000000000000000000000000000000000000000b5e77f7ff1ab31fc1be99f484db62f01a6b93d4d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000007c4bf7b90d70000000000000000000000000000000032d3631b04fc4d9bb80388a5634c4c3f000000000000000000000000055f44a1f92651557fd7f8e47ced5fdd2fb5e02b0000000000000000000000000dca2a8535a81b8dbc22ca7b3e2973fe38320cf60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000240000000000000000000000000000000000000000000000000000000000000078000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000520000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000027100000000000000000000000000000000000000000000000000000000000000240000000000000000000000000000000000000000000000000000000000000028000000000000000000000000000000000000000000000000000000000000002c000000000000000000000000000000000000000000000000000000000000002e00000000000000000000000000000000000000000000000000000000000000340000000000000000000000000000000000000000000000000000000000000038000000000000000000000000000000000000000000000000000000000000003c00000000000000000000000000000000000000000000000000000000000000420000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004c0000000000000000000000000000000000000000000000000000000000000002465326465613663662d323264612d353266312d613239332d61343132343463636137353500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a6569703135353a31333700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a6569703135353a31333700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000831363731363430380000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a307838386339343962346562383561393030373166326330626566383631626464656531613734373964000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001320000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000023130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a3078326332353035443045323166333246333862434542656361314333333161623430363962424362390000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000023130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a3078326332353035443045323166333246333862434542656361314333333161623430363962424362390000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000147b22736c69707061676555736564223a2234227d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000004535741500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
    //   "callGasLimit": "0x547fc",
    //   "maxFeePerGas": "0x1ad274800",
    //   "maxPriorityFeePerGas": "0x1ad274800",
    //   "nonce": "0x0000000000000000000000000000000032d3631b04fc4d9bb80388a5634c4c3f",
    //   "paymaster": "0xdaa292e9b9a6b287c84d636f3b65f4a5dc787e3f",
    //   "paymasterData": "0x000000000000000000000000055f44a1f92651557fd7f8e47ced5fdd2fb5e02b00000000000000000000000000000000000000000000000000000000681923ec0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000415b13a7a5a7a0274d3caecf1f108c7f409409c0f61751ae969625d187566cf6b725cf2b4e02be9cb6eb7e0e3d3c2db6feb5e8a125b4312862ac5e6c36892ec7721b00000000000000000000000000000000000000000000000000000000000000",
    //   "paymasterPostOpGasLimit": "0x2857",
    //   "paymasterVerificationGasLimit": "0x138bb",
    //   "preVerificationGas": "0x16d3c",
    //   "sender": "0x0dca2a8535a81b8dbc22ca7b3e2973fe38320cf6",
    //   "verificationGasLimit": "0x286f9"
    //  }

    const signedUserOp = await signUserOp(userOp, sessionConfig);
    console.log("Signed UserOp: ", signedUserOp);
    // Sample Response:
    //   signed UserOp:  {
    //   "callData": "0x8dd7712f00000000000000000000000000000000000000000000000000000000000000000000000000000000b5e77f7ff1ab31fc1be99f484db62f01a6b93d4d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000007c4bf7b90d70000000000000000000000000000000032d3631b04fc4d9bb80388a5634c4c3f000000000000000000000000055f44a1f92651557fd7f8e47ced5fdd2fb5e02b0000000000000000000000000dca2a8535a81b8dbc22ca7b3e2973fe38320cf60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000240000000000000000000000000000000000000000000000000000000000000078000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000520000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000027100000000000000000000000000000000000000000000000000000000000000240000000000000000000000000000000000000000000000000000000000000028000000000000000000000000000000000000000000000000000000000000002c000000000000000000000000000000000000000000000000000000000000002e00000000000000000000000000000000000000000000000000000000000000340000000000000000000000000000000000000000000000000000000000000038000000000000000000000000000000000000000000000000000000000000003c00000000000000000000000000000000000000000000000000000000000000420000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004c0000000000000000000000000000000000000000000000000000000000000002465326465613663662d323264612d353266312d613239332d61343132343463636137353500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a6569703135353a31333700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a6569703135353a31333700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000831363731363430380000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a307838386339343962346562383561393030373166326330626566383631626464656531613734373964000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001320000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000023130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a3078326332353035443045323166333246333862434542656361314333333161623430363962424362390000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000023130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a3078326332353035443045323166333246333862434542656361314333333161623430363962424362390000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000147b22736c69707061676555736564223a2234227d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000004535741500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
    //   "callGasLimit": "0x547fc",
    //   "maxFeePerGas": "0x1ad274800",
    //   "maxPriorityFeePerGas": "0x1ad274800",
    //   "nonce": "0x0000000000000000000000000000000032d3631b04fc4d9bb80388a5634c4c3f",
    //   "paymaster": "0xdaa292e9b9a6b287c84d636f3b65f4a5dc787e3f",
    //   "paymasterData": "0x000000000000000000000000055f44a1f92651557fd7f8e47ced5fdd2fb5e02b00000000000000000000000000000000000000000000000000000000681923ec0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000415b13a7a5a7a0274d3caecf1f108c7f409409c0f61751ae969625d187566cf6b725cf2b4e02be9cb6eb7e0e3d3c2db6feb5e8a125b4312862ac5e6c36892ec7721b00000000000000000000000000000000000000000000000000000000000000",
    //   "paymasterPostOpGasLimit": "0x2857",
    //   "paymasterVerificationGasLimit": "0x138bb",
    //   "preVerificationGas": "0x16d3c",
    //   "sender": "0x0dca2a8535a81b8dbc22ca7b3e2973fe38320cf6",
    //   "verificationGasLimit": "0x286f9"
    //   "signature": "0xaeffe7a4cececd894d55cc8a049b6fb042d5e3481d7242a2c1cd81a63161a6c313bc7ad89c91ef2c44b21213c740765b4d87b32e5e84598b0284396e39565db61b"
    // }

    // Execute the userOp
    const jobId = await executeUserOp(signedUserOp, OktoAuthToken);
    console.log("Job ID:", jobId);
    // Sample Response:
    //   jobId: a0a54427-11c8-4140-bfcc-e96af15ce9cf

    // Check the status of the jobId and get the transaction details
    const txn_details = await getOrderHistory(OktoAuthToken, jobId, "SWAP");
    console.log("Order Details:", JSON.stringify(txn_details, null, 2));
  } catch (err: any) {
    console.error(
      "Failed to estimate or execute user operation:",
      err.response?.data || err.message
    );
  }
}

// To get the caipId, please check: https://docsv2.okto.tech/docs/openapi/technical-reference
const data: Data = {
  fromChainCaip2Id: "eip155:8453",
  fromChainTokenAmount: "100000000",
  toChainCaip2Id: "eip155:137",
  fromChainTokenAddress: "",
  toChainTokenAddress: "",
  slippage: "3",
  sameChainFee: "0",
  sameChainFeeCollector: "0x8aaf1F5A168EE78D1b96df345eCaf0098607B8F6",
  crossChainFee: "0",
  crossChainFeeCollector: "0x8aaf1F5A168EE78D1b96df345eCaf0098607B8F6",
  toTokenAmountMinimum: null,
  advancedSettings: null,
};

const sessionConfig: SessionConfig = {
  sessionPrivKey:
    "0xb9aa73c6d669e81c23bd1d45d94d9cccbec4b435e381eb6886438a18e3d2683e",
  sessionPubkey:
    "0x042f96f4a0e66ed0fbc4b6833e32987fdb9d16ad980846b30bead8929d2c3c1e6488daba0d1928c5083aa3557009574212649a91b8a9203df53a6478111324055b",
  userSWA: "0xfBb05b5Bf0192458E0Ca5946d7B82a61Eba98025",
};

swap(data, sessionConfig);
